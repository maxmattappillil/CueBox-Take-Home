# Assumptions and Decisions

- The "CB Constituent ID" is directly mapped from the "Patron ID" in the input data.
- The "CB Created At" is directly mapped to the "Date Entered" field. If a timestamp was not present in this column for a row of data, the default time is 00:00:00
- For determining "CB Constituent Type":
  * A record is marked as "Person" if any of these conditions are met:
    - Both First Name and Last Name are present
    - Title field is present
    - Gender is present and not "Unknown"
    - Tags contain "Student Scholar"
  * Otherwise, the record is marked as "Company". Also if the row contains only the "Patron ID" and "Date Entered" fields, it is assumed to be a company.

- For determining "CB Title":
  * If the "Title" column contains multiple titles separated by "and", the first title is selected.

- For determining "CB Email 1 and 2":
    - The primary email is assumed to be "CB Email 1".
    - The email CSV may not be in order by patron ID with the primary email being the first item per group, so this is handled accordingly.

- For resolving duplicate Patron IDs:
   * We identify duplicates in the constituents dataframe by checking for repeated Patron IDs.
   * We resolve duplicates by matching primary emails from the emails dataframe.
   * If a match is found, the duplicate with the matching primary email is retained.
   * Unresolved duplicates are output to a CSV file for further inspection.

- For determining CB Lifetime Donation Amount, Most Recent Donation Date, and Most Recent Donation
   * "CB Lifetime Donation Amount" is the total of all donations with a status of "Paid".
   * "CB Most Recent Donation Date" and "CB Most Recent Donation Amount" are based on the most recent donation with a status of "Paid".
   * Donations with a status of "Refunded" are not considered in these calculations.

- For mapping tags, only unique mapped tag values are returned to avoid duplicates.

# Questions for Client Success Manager

- Why are there empty rows with only a patron id and date entered?
- How can a donation be recorded for Patron ID 1288 that occurred before the patron was entered into the system according to the constituents file?
